<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ruleta de Sorteo</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f0f4f8;
    margin: 0; padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    flex-direction: column;
  }
  #container {
    display: flex;
    gap: 40px;
    align-items: center;
    background: white;
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 8px 20px rgb(0 0 0 / 0.1);
  }
  #listContainer {
    max-width: 200px;
  }
  #listContainer h2 {
    margin-top: 0;
    color: #333;
    text-align: center;
  }
  #namesList {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  #namesList li {
    padding: 8px 12px;
    margin: 6px 0;
    background: #dde6f3;
    border-radius: 8px;
    font-weight: 600;
    color: #222;
  }
  #namesList li.chosen {
    background: #a0d468;
    color: #fff;
    font-weight: 700;
  }
  #rouletteCanvas {
    border-radius: 50%;
    box-shadow: 0 4px 15px rgb(0 0 0 / 0.15);
    cursor: pointer;
  }
  #spinButton {
    margin-top: 20px;
    width: 100%;
    padding: 10px 0;
    background: #3366ff;
    color: white;
    font-weight: 700;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    user-select: none;
  }
  #spinButton:hover {
    background: #254eda;
  }

  /* Popup ganador */
  #winnerPopup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #3366ff;
    color: white;
    padding: 30px 40px;
    border-radius: 15px;
    box-shadow: 0 8px 30px rgb(51 102 255 / 0.7);
    display: none;
    z-index: 1000;
    text-align: center;
    user-select: none;
  }
  #winnerPopup h2 {
    margin: 0 0 20px 0;
    font-size: 28px;
  }
  #closeWinner {
    background: white;
    color: #3366ff;
    border: none;
    padding: 10px 25px;
    border-radius: 8px;
    font-weight: 700;
    cursor: pointer;
    transition: background-color 0.25s ease;
  }
  #closeWinner:hover {
    background: #e6e6e6;
  }
</style>
</head>
<body>

<div id="container">
  <div id="listContainer">
    <h2>Participantes</h2>
    <ul id="namesList"></ul>
    <button id="spinButton">Girar Ruleta</button>
  </div>
  <canvas id="rouletteCanvas" width="450" height="450" title="Ruleta de participantes"></canvas>
</div>

<div id="winnerPopup">
  <h2>¡Ganador!</h2>
  <div id="winnerName" style="font-size: 36px; font-weight: 900; margin-bottom: 20px;"></div>
  <button id="closeWinner">Cerrar</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
<script>
  // Lista de nombres (puedes editar aquí)
  const names = [
    "Ana", "Carlos", "Luis", "María", "Jorge",
    "Sofía", "Pedro", "Lucía", "Miguel", "Elena"
  ];
  const chosen = [];
  let currentHighlightedName = null;

  // Referencias DOM
  const namesList = document.getElementById('namesList');
  const spinButton = document.getElementById('spinButton');
  const winnerPopup = document.getElementById('winnerPopup');
  const winnerNameDiv = document.getElementById('winnerName');
  const closeWinnerBtn = document.getElementById('closeWinner');
  const canvas = document.getElementById('rouletteCanvas');
  const ctx = canvas.getContext('2d');

  // Pintar lista de nombres, marca los ya elegidos
  function renderNamesList() {
    namesList.innerHTML = '';
    names.forEach(name => {
      const li = document.createElement('li');
      li.textContent = name;
      if (chosen.includes(name)) li.classList.add('chosen');
      namesList.appendChild(li);
    });
  }

  // Colores distintos para cada segmento
  function getColor(i, total) {
    const hue = (i * 360 / total) % 360;
    return `hsl(${hue}, 70%, 65%)`;
  }

  // Dibuja la ruleta
  function drawRoulette() {
    const filtered = names.filter(n => !chosen.includes(n));
    const total = filtered.length;
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Fondo blanco circular
    ctx.beginPath();
    ctx.fillStyle = "#fff";
    ctx.arc(canvas.width / 2, canvas.height / 2, canvas.width / 2, 0, 2 * Math.PI);
    ctx.fill();

    if (total === 0) {
      // Si no quedan nombres, muestra mensaje
      ctx.fillStyle = "#555";
      ctx.font = "bold 24px sans-serif";
      ctx.textAlign = "center";
      ctx.fillText("No quedan participantes", canvas.width/2, canvas.height/2);
      return;
    }

    const radius = canvas.width / 2;
    const center = { x: radius, y: radius };
    const angleStep = (2 * Math.PI) / total;

    filtered.forEach((name, i) => {
      const angle = i * angleStep;
      ctx.beginPath();
      ctx.moveTo(center.x, center.y);
      ctx.arc(center.x, center.y, radius, angle, angle + angleStep);
      ctx.closePath();
      ctx.fillStyle = getColor(i, total);
      ctx.fill();
      ctx.strokeStyle = "#fff";
      ctx.lineWidth = 2;
      ctx.stroke();

      // Texto centrado en el sector
      ctx.save();
      ctx.translate(center.x, center.y);
      ctx.rotate(angle + angleStep / 2);
      ctx.textAlign = "right";
      ctx.textBaseline = "middle";
      ctx.fillStyle = (name === currentHighlightedName) ? "#d62828" : "#222";
      ctx.font = "bold 22px 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif";
      ctx.fillText(name, radius - 25, 0);
      ctx.restore();
    });
  }

  // Confeti simplificado que no deja residuos
  function launchConfetti() {
    const duration = 1000;
    const animationEnd = Date.now() + duration;
    const defaults = {
      origin: { y: 0.6 },
      particleCount: 50,
      spread: 55,
      ticks: 50,
    };

    (function frame() {
      confetti({
        ...defaults,
        particleCount: 5,
        startVelocity: 30,
        colors: ['#d62828', '#f77f00', '#fcbf49', '#2a9d8f', '#264653'],
        shapes: ['circle'],
        gravity: 0.5,
      });
      if (Date.now() < animationEnd) {
        requestAnimationFrame(frame);
      }
    })();
  }

  // Función para girar la ruleta y elegir un ganador
  function spinRoulette() {
    const remaining = names.filter(n => !chosen.includes(n));
    if (remaining.length === 0) {
      alert("Ya se han seleccionado todos los participantes.");
      return;
    }

    const winner = remaining[Math.floor(Math.random() * remaining.length)];
    chosen.push(winner);

    currentHighlightedName = winner;
    drawRoulette();

    launchConfetti();

    winnerNameDiv.textContent = winner;
    winnerPopup.style.display = "block";
  }

  // Cerrar popup
  function closeWinnerPopup() {
    winnerPopup.style.display = "none";
    currentHighlightedName = null;
    drawRoulette();
  }

  // Eventos
  spinButton.addEventListener('click', spinRoulette);
  closeWinnerBtn.addEventListener('click', closeWinnerPopup);

  // Inicializar
  renderNamesList();
  drawRoulette();
</script>
</body>
</html>
